# Database Fixes Reference

Quick reference for common database fixes in the Human OS system.

## Sculptor Sessions (Executive Reports)

Executive reports generated by Sculptor are stored in the `sculptor_sessions` table in the **humanos-staging** Supabase project.

### Table Structure

- `id` (UUID): Session identifier
- `entity` (text): Entity name (e.g., "scott", "chris")
- `metadata` (JSONB): Contains the full executive report including:
  - `executive_report.personality` - Array of personality traits
  - `executive_report.identity` - Identity information
  - Other report sections

### Finding a Session

```sql
-- Find sessions by entity name
SELECT id, entity, created_at, metadata->'executive_report'->'personality' as personality
FROM sculptor_sessions
WHERE entity = 'scott'
ORDER BY created_at DESC
LIMIT 5;
```

### Viewing Personality Data

```sql
-- View full personality array
SELECT metadata->'executive_report'->'personality' as personality
FROM sculptor_sessions
WHERE id = '408c50a8-748d-4ba2-9852-c49b95c26345';

-- View specific personality trait (0-indexed)
SELECT metadata->'executive_report'->'personality'->0->>'description' as description
FROM sculptor_sessions
WHERE id = '408c50a8-748d-4ba2-9852-c49b95c26345';
```

### Updating Personality Text

To update a specific field in the personality array:

```sql
-- Update the description of the first personality trait (index 0)
UPDATE sculptor_sessions
SET metadata = jsonb_set(
  metadata,
  '{executive_report,personality,0,description}',
  '"Your corrected text here"'::jsonb
)
WHERE id = 'session-uuid-here';

-- Update the trait name
UPDATE sculptor_sessions
SET metadata = jsonb_set(
  metadata,
  '{executive_report,personality,0,trait}',
  '"Corrected trait name"'::jsonb
)
WHERE id = 'session-uuid-here';

-- Update the insight
UPDATE sculptor_sessions
SET metadata = jsonb_set(
  metadata,
  '{executive_report,personality,0,insight}',
  '"Corrected insight text"'::jsonb
)
WHERE id = 'session-uuid-here';
```

### JSONB Path Reference

- `{executive_report,personality,0,trait}` - First trait's name
- `{executive_report,personality,0,description}` - First trait's description
- `{executive_report,personality,0,insight}` - First trait's insight
- `{executive_report,personality,1,...}` - Second trait (index 1)
- `{executive_report,personality,2,...}` - Third trait (index 2)

### Example Fix: Scott's Medical History

**Issue:** LLM incorrectly changed "4 years of medical hell" to "6 uyears of medical heck"

**Fix applied:**
```sql
UPDATE sculptor_sessions
SET metadata = jsonb_set(
  metadata,
  '{executive_report,personality,0,description}',
  '"Four years of medical hell and nine surgeries rewired his brain to see through fear''s illusions and focus on what''s actually possible"'::jsonb
)
WHERE id = '408c50a8-748d-4ba2-9852-c49b95c26345';
```

**Note:** Single quotes in the text must be escaped as `''` (double single-quotes) in SQL.

## Supabase MCP Tools

You can execute these queries using the Supabase MCP tools:
- `mcp__supabase-humanos-staging__execute_sql` - For SELECT/UPDATE queries
- `mcp__supabase-humanos-staging__list_tables` - To see available tables

## Prevention

The agent grounding instructions in `apps/goodhang/lib/shared/agent-grounding.ts` help prevent manipulation attempts that could lead to incorrect edits like this.
